generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output        = "./generated/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id                String             @id @default(cuid())
    email             String             @unique
    password          String
    name              String
    profile_avatar    String?
    locations         Location[]
    events            Event[]
    reviews           Review[]
    comments          Comment[]
    eventParticipants EventParticipant[]
    favorites         Favorite[]
}

model Location {
    id          String       @id @default(cuid())
    name        String
    address     String
    description String?
    images      String[]
    createdBy   User         @relation(fields: [createdById], references: [id])
    createdById String
    reviews     Review[]
    comments    Comment[]
    createdAt   DateTime     @default(now())
    type        LocationType
    events      Event[]
    favorites   Favorite[]
    lat         Float?
    lon         Float?
}

model AddressCache {
    id        String   @id @default(cuid())
    key       String   @unique
    address   String
    lat       Float
    lon       Float
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Review {
    id         String   @id @default(cuid())
    comment    String?
    rating     Int
    location   Location @relation(fields: [locationId], references: [id])
    locationId String
    user       User     @relation(fields: [userId], references: [id])
    userId     String
    createdAt  DateTime @default(now())
}

model Comment {
    id         String    @id @default(cuid())
    content    String
    createdAt  DateTime  @default(now())
    parent     Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
    parentId   String?
    replies    Comment[] @relation("CommentReplies")
    event      Event?    @relation(fields: [eventId], references: [id])
    eventId    String?
    location   Location? @relation(fields: [locationId], references: [id])
    locationId String?
    user       User      @relation(fields: [userId], references: [id])
    userId     String
}

model Event {
    id                String             @id @default(cuid())
    createdBy         User               @relation(fields: [createdById], references: [id])
    createdById       String
    createdAt         DateTime           @default(now())
    location          Location?          @relation(fields: [locationId], references: [id])
    locationId        String?
    address           String
    title             String
    description       String
    startsAt          DateTime
    endsAt            DateTime?
    comments          Comment[]
    eventParticipants EventParticipant[]
}

model EventParticipant {
    id          String   @id @default(cuid())
    event       Event    @relation(fields: [eventId], references: [id])
    eventId     String
    user        User     @relation(fields: [userId], references: [id])
    userId      String
    interested  Boolean  @default(false)
    willBeThere Boolean  @default(false)
    createdAt   DateTime @default(now())

    @@unique([eventId, userId])
}

model Favorite {
    id         String   @id @default(cuid())
    userId     String
    locationId String
    user       User     @relation(fields: [userId], references: [id])
    location   Location @relation(fields: [locationId], references: [id])

    @@unique([userId, locationId])
}

enum LocationType {
    PARK
    RESTAURANT
    HOTEL
    MUSEUM
    STORE
    CAFÃ‰
    OTHER
}

enum Role {
    CLIENT
    CREATOR
}
